#!/usr/bin/env bash

set -o pipefail

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/app-launcher"
CACHE_FILE="$CACHE_DIR/desktop-apps.cache"
CACHE_MAX_AGE=3600  # 1 —á–∞—Å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫—ç—à–∞ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
mkdir -p "$CACHE_DIR"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ .desktop —Ñ–∞–π–ª–æ–≤
parse_desktop_file() {
    local file="$1"
    local name=""
    local exec_cmd=""
    local hidden=""
    local nodisplay=""
    local tryexec=""
    local notshowin=""
    local onlyshowin=""
    local current_section=""
    
    # –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª –ø–æ—Å—Ç—Ä–æ—á–Ω–æ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
    while IFS= read -r line || [[ -n "$line" ]]; do
        # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
        line="${line#"${line%%[![:space:]]*}"}"
        line="${line%"${line##*[![:space:]]}"}"
        
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        [[ -z "$line" || "$line" == \#* ]] && continue
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ–∫—Ü–∏–∏
        if [[ "$line" == \[*\] ]]; then
            current_section="$line"
            continue
        fi
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–µ–∫—Ü–∏—é Desktop Entry
        [[ "$current_section" != "[Desktop Entry]" ]] && continue
        
        case "$line" in
            Name=*)
                [[ -z "$name" ]] && name="${line#Name=}"
                ;;
            Exec=*)
                [[ -z "$exec_cmd" ]] && exec_cmd="${line#Exec=}"
                ;;
            Hidden=*)
                hidden="${line#Hidden=}"
                ;;
            NoDisplay=*)
                nodisplay="${line#NoDisplay=}"
                ;;
            TryExec=*)
                tryexec="${line#TryExec=}"
                ;;
            NotShowIn=*)
                notshowin="${line#NotShowIn=}"
                ;;
            OnlyShowIn=*)
                onlyshowin="${line#OnlyShowIn=}"
                ;;
        esac
    done < "$file"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
    [[ -z "$name" || -z "$exec_cmd" ]] && return 1
    [[ "$hidden" == "true" || "$nodisplay" == "true" ]] && return 1
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º TryExec
    if [[ -n "$tryexec" ]]; then
        local found=0
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—É—Ç–µ–π
        if command -v "$tryexec" >/dev/null 2>&1; then
            found=1
        elif [[ -f "$tryexec" && -x "$tryexec" ]]; then
            found=1
        elif [[ -f "/usr/bin/$tryexec" && -x "/usr/bin/$tryexec" ]]; then
            found=1
        elif [[ -f "/bin/$tryexec" && -x "/bin/$tryexec" ]]; then
            found=1
        fi
        [[ $found -eq 0 ]] && return 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º OnlyShowIn/NotShowIn (–ø—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è)
    if [[ -n "$onlyshowin" ]]; then
        # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω OnlyShowIn –∏ —Ç–µ–∫—É—â–∞—è —Å—Ä–µ–¥–∞ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        if [[ -z "$XDG_CURRENT_DESKTOP" ]] || ! grep -qi "$XDG_CURRENT_DESKTOP" <<< "$onlyshowin"; then
            return 1
        fi
    fi
    
    if [[ -n "$notshowin" ]]; then
        # –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω NotShowIn –∏ —Ç–µ–∫—É—â–∞—è —Å—Ä–µ–¥–∞ –≤ —Å–ø–∏—Å–∫–µ - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        if [[ -n "$XDG_CURRENT_DESKTOP" ]] && grep -qi "$XDG_CURRENT_DESKTOP" <<< "$notshowin"; then
            return 1
        fi
    fi
    
    # –û—á–∏—â–∞–µ–º Exec –æ—Ç % –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    exec_cmd=$(echo "$exec_cmd" | sed -E '
        s/%[UDFNnmickv]//g;
        s/%[%]/?/g;
        s/%[a-zA-Z]//g;
        s/\\s/ /g;
        s/^"//; s/"$//;
        s/^ *//; s/ *$//
    ')
    
    # –û—á–∏—â–∞–µ–º –∏–º—è –æ—Ç —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è dmenu
    local clean_name=$(echo "$name" | sed -E '
        s/&//g;
        s/[<>|]/_/g;
        s/^\s+|\s+$//g
    ')
    
    echo "$clean_name|$exec_cmd|$file"
    return 0
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ .desktop —Ñ–∞–π–ª–æ–≤
find_desktop_files() {
    local desktop_dirs=()
    local seen_files=()  # –ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
    local temp_file
    temp_file=$(mktemp)
    
    # 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    IFS=':' read -ra xdg_dirs <<< "${XDG_DATA_DIRS:-/usr/local/share:/usr/share}"
    for dir in "${xdg_dirs[@]}"; do
        [[ -d "$dir/applications" ]] && desktop_dirs+=("$dir/applications")
    done
    
    # 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
    [[ -d "$HOME/.local/share/applications" ]] && desktop_dirs+=("$HOME/.local/share/applications")
    
    # 3. Flatpak —Å–∏—Å—Ç–µ–º–Ω—ã–µ
    if [[ -d "/var/lib/flatpak/exports/share/applications" ]]; then
        desktop_dirs+=("/var/lib/flatpak/exports/share/applications")
    fi
    
    # 4. Flatpak –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ
    if [[ -d "$HOME/.local/share/flatpak/exports/share/applications" ]]; then
        desktop_dirs+=("$HOME/.local/share/flatpak/exports/share/applications")
    fi
    
    # 5. Snap –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    [[ -d "/var/lib/snapd/desktop/applications" ]] && desktop_dirs+=("/var/lib/snapd/desktop/applications")
	
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º find —Å -print0 –∏ xargs -0 –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
    for dir in "${desktop_dirs[@]}"; do
        if [[ -d "$dir" ]]; then
            find "$dir" -maxdepth 3 -name "*.desktop" -type f,l -print0 2>/dev/null |  \
            while IFS= read -r -d '' file; do
                [[ -r "$file" ]] || continue
                
                # –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ –±–∞–∑–æ–≤–æ–º—É –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
                local basename=$(basename "$file")
                if [[ ! " ${seen_files[@]} " =~ " ${basename} " ]]; then
                    seen_files+=("$basename")
                    parse_desktop_file "$file" >> "$temp_file" &
                    
                    # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
                    if [[ $(jobs -r | wc -l) -ge 4 ]]; then
                        wait -n
                    fi
                fi
            done
        fi
    done
    
    wait  # –î–æ–∂–∏–¥–∞–µ–º—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    
    # –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ –∏–º–µ–Ω–∏, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–µ—Ä–≤—ã–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π) –Ω–∞–π–¥–µ–Ω–Ω—ã–π
    awk -F'|' '!seen[$1]++' "$temp_file" | sort -f -t'|' -k1,1
    
    rm -f "$temp_file"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—ç—à–∞
update_cache() {
    local cache_tmp="$CACHE_FILE.tmp.$$"
    local count=0
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
    find_desktop_files > "$cache_tmp"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∫—ç—à –Ω–µ –ø—É—Å—Ç–æ–π
    if [[ -s "$cache_tmp" ]]; then
        # –ê—Ç–æ–º–∞—Ä–Ω–æ –∑–∞–º–µ–Ω—è–µ–º –∫—ç—à
        mv -f "$cache_tmp" "$CACHE_FILE"
        count=$(wc -l < "$CACHE_FILE")
        date +%s > "$CACHE_DIR/last-update"
        echo "‚úÖ –ö—ç—à –æ–±–Ω–æ–≤–ª–µ–Ω: $count –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π" >&2
    else
        rm -f "$cache_tmp"
        if [[ ! -s "$CACHE_FILE" ]]; then
            echo "‚ö†Ô∏è  –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" >&2
            return 1
        fi
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞
is_cache_valid() {
    [[ -f "$CACHE_FILE" ]] || return 1
    [[ -s "$CACHE_FILE" ]] || return 1
    [[ -f "$CACHE_DIR/last-update" ]] || return 1
    
    local last_update=$(cat "$CACHE_DIR/last-update" 2>/dev/null)
    [[ -n "$last_update" ]] || return 1
    
    local current_time=$(date +%s)
    local cache_age=$((current_time - last_update))
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑—Ä–∞—Å—Ç –∫—ç—à–∞ –∏ —Ä–∞–∑–º–µ—Ä
    [[ $cache_age -le $CACHE_MAX_AGE ]] && return 0
    return 1
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤ –∫—ç—à–µ
search_in_cache() {
    local query="$1"
    local mode="${2:-exact}"
    
    if [[ "$mode" == "exact" ]]; then
        # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–Ω–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏)
        grep -E "^$query\\|" "$CACHE_FILE" 2>/dev/null | head -n1
    else
        # –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞)
        grep -i "$query" "$CACHE_FILE" 2>/dev/null | head -n1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
run_app() {
    local app_name="$1"
    
    if [[ -z "$app_name" ]]; then
        echo "‚ùå –û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" >&2
        return 1
    fi
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if ! is_cache_valid; then
        echo "üîÑ –ö—ç—à —É—Å—Ç–∞—Ä–µ–ª, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ..." >&2
        update_cache
    fi
    
    # –ò—â–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    local app_info=$(search_in_cache "$app_name" "exact")
    
    # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ–±—É–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
    if [[ -z "$app_info" ]]; then
        app_info=$(search_in_cache "$app_name" "partial")
    fi
    
    if [[ -n "$app_info" ]]; then
        local exec_cmd=$(echo "$app_info" | cut -d'|' -f2)
        local original_name=$(echo "$app_info" | cut -d'|' -f1)
        local desktop_file=$(echo "$app_info" | cut -d'|' -f3)
        
        echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫: $original_name" >&2
        
        # –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è Flatpak
        if [[ "$desktop_file" == *flatpak* ]]; then
            local app_id=$(basename "$desktop_file" .desktop)
            exec_cmd="flatpak run $app_id"
        fi
        
        # –û—á–∏—â–∞–µ–º –∫–æ–º–∞–Ω–¥—É —Ñ–∏–Ω–∞–ª—å–Ω–æ
        exec_cmd=$(echo "$exec_cmd" | sed -E '
            s/%[UDFNnmickv]//g;
            s/%[%]/?/g;
            s/%[a-zA-Z]//g;
            s/^"//; s/"$//;
            s/^ *//; s/ *$//
        ')
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–µ—Ç–∞—á–º–µ–Ω—Ç–æ–º
        if command -v setsid >/dev/null 2>&1; then
            (nohup setsid /bin/sh -c "exec $exec_cmd" >/dev/null 2>&1 &)
        else
            (nohup /bin/sh -c "exec $exec_cmd" >/dev/null 2>&1 &)
        fi
        
        # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–ø—É—Å–∫
        sleep 0.1
        
        echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ" >&2
        return 0
    else
        echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ '$app_name' –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" >&2
        echo "" >&2
        echo "üìã –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–¥–Ω–æ –∏–∑:" >&2
        list_apps | head -10 | sed 's/^/   /' >&2
        return 1
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
list_apps() {
    # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞
    if ! is_cache_valid; then
        update_cache >/dev/null 2>&1 &
        local spinner_pid=$!
        echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞..." >&2
        wait $spinner_pid
    fi
    
    if [[ ! -s "$CACHE_FILE" ]]; then
        echo "‚ö†Ô∏è  –ö—ç—à –ø—É—Å—Ç, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ..." >&2
        update_cache
    fi
    
    # –ë—ã—Å—Ç—Ä—ã–π –≤—ã–≤–æ–¥ —Ç–æ–ª—å–∫–æ –∏–º–µ–Ω
    cut -d'|' -f1 "$CACHE_FILE" 2>/dev/null | sort -f | uniq
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
show_stats() {
    local total=$(wc -l < "$CACHE_FILE" 2>/dev/null || echo "0")
    local cache_age="–Ω–µ—Ç"
    
    if [[ -f "$CACHE_DIR/last-update" ]]; then
        local last=$(cat "$CACHE_DIR/last-update")
        local now=$(date +%s)
        local age=$((now - last))
        if [[ $age -lt 60 ]]; then
            cache_age="${age} —Å–µ–∫"
        elif [[ $age -lt 3600 ]]; then
            cache_age="$((age / 60)) –º–∏–Ω"
        else
            cache_age="$((age / 3600)) —á $(((age % 3600) / 60)) –º–∏–Ω"
        fi
    fi
    
    echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:"
    echo "   –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–π: $total"
    echo "   –ö—ç—à –æ—Ç: $cache_age"
    echo "   –§–∞–π–ª: $CACHE_FILE"
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    local mode="list"
    local app_name=""
    
    # –ë—ã—Å—Ç—Ä—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
    while [[ $# -gt 0 ]]; do
        case $1 in
            -l|--list)
                mode="list"
                shift
                ;;
            -r|--run)
                mode="run"
                shift
                app_name="$*"
                break
                ;;
            -u|--update)
                update_cache
                exit $?
                ;;
            -s|--stats)
                show_stats
                exit 0
                ;;
            -h|--help)
                echo "üîç App Launcher - –±—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
                echo ""
                echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 [–û–ü–¶–ò–ò]"
                echo ""
                echo "–û–ø—Ü–∏–∏:"
                echo "  -l, --list              –í—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
                echo "  -r, --run <app>         –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
                echo "  -u, --update            –û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à"
                echo "  -s, --stats             –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"
                echo "  -h, --help              –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"
                echo ""
                echo "–ü—Ä–∏–º–µ—Ä—ã:"
                echo "  $0 -l | dmenu -l 20 -p '–ó–∞–ø—É—Å–∫:'"
                echo "  $0 -r firefox"
                echo "  $0 --run \"Visual Studio Code\""
                echo "  $0 -u"
                exit 0
                ;;
            *)
                # –ï—Å–ª–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç, –ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                mode="run"
                app_name="$1"
                shift
                ;;
        esac
    done
    
    case $mode in
        list)
            list_apps
            ;;
        run)
            run_app "$app_name"
            ;;
    esac
}

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
trap 'echo "‚ö†Ô∏è  –û—à–∏–±–∫–∞ –≤ —Å—Ç—Ä–æ–∫–µ $LINENO" >&2' ERR

# –ó–∞–ø—É—Å–∫
main "$@"
